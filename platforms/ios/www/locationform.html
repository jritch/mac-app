<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <![endif]-->

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Age-CAP</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrapresponsive.min.css">
        <link rel="stylesheet" href="css/main.css">
        
        <script src="js/vendor/modernizr262respond110min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

<!-- ==========================================================================
   Navbar Code
   ========================================================================== -->

        <div class="navbar navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container-fluid" id="header-container">
            
              <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <div id="back-btn"> <button class="btn btn-primary" onClick="history.go(-1);return true;">BACK</button> </div>
              <a id="page-title" class="brand" href="#">Location Details</a>
              <div class="nav-collapse collapse">
                <ul class="nav">
                  <li><a href="index.html">Home <span class="icon-home"></span></a></li>
                  <li> <a id="font-button">Change Font Size  <span class="icon-font"></span></a></li>
                  <li> <a href="feedback.html" id="feedback-button">Give Feedback  <span class="icon-thumbs-up"></span></a></li>
                  <li> <a href="#myModal" data-toggle="modal">About Age-CAP</a></li>
                </ul>
              </div><!--/.nav-collapse -->

            </div>
          </div>
        </div>

<!-- ==========================================================================
   End Navbar Code
   ========================================================================== -->

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span8 offset2 question_background">
            <h4>Fill in the details of the location below, completing as many fields as possible</h4>
        </div> 
    </div>

    <div class="spacer10"></div>  

<div class="row-fluid">
<div class="span8 offset2 question_background"> 
    <form class="form-horizontal">
       <div class="control-group">
        <label class="control-label">Name of Location</label>
        <div class="controls">
          <input type="text" id="inputName" placeholder="Alice's Restaurant">
        </div>
      </div> 

      <div class="control-group">
        <label class="control-label">Street Address</label>
        <div class="controls">
          <input type="text" id="inputAddress" placeholder="1234 Address Rd.">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label">City</label>
        <div class="controls">
          <input type="text" id="inputCity" placeholder="Townsville">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="inputProvince">Province/State</label>
        <div class="controls">
          <input type="text" id="inputProvince" placeholder="East Virginia">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label">Postal Code</label>
        <div class="controls">
          <input type="text" id="inputPostal" placeholder="A1B 2C3">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="inputProvince">Country</label>
        <div class="controls">
          <input type="text" id="inputCountry" placeholder="Prussia">
        </div>
      </div>

      <div class="control-group">
        <div class="controls">
          <a type="submit" class="btn btn-primary" id="submit-button">CONTINUE</a>
        </div>
      </div>
</form>
</div>
<div class="percent-spacer"></div>

</div> <!-- /container -->

<!-- ==========================================================================
  Modal Code
   ========================================================================== -->

        <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">  
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h3 id="myModalLabel">About Age-CAP</h3>
          </div>
          <div class="modal-body">
            <p style=\'text-align:justify\'>Age-CAP is a smartphone application which aims to create a crowd-sourced database of age-friendly locations. It consists of survey styled forms which enable users to quickly rate a location. Users are also able to browse this database to assess the age-friendliness of locations in their neighborhood, providing them access to information which was otherwise unavailable. <br><br>Age-CAP was created by a multi-disciplinary team from the Toronto Rehabilitation Institute, University Health Network and University of Toronto.<br><br>Feedback or questions: iatsl@utoronto.ca</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
          </div>
        </div>
<!-- ==========================================================================
   End Modal Code
   ========================================================================== -->
       
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery191min.js"><\/script>')</script> <!--- failsafe to load up jQuery if the online copy is unavailable-->
        <script src="js/vendor/bootstrap.min.js"></script>
        
        <script src="js/main.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
        <script>
        $("#submit-button").click(function() {

          var ratingLocation = {name: $("#inputName").val(), address: $("#inputAddress").val(),
                              city: $("#inputCity").val(), state: $("#inputProvince").val(), postal: $("#inputPostal").val(),
                              country: $("#inputCountry").val()}


          //build a submission string from the user's information 
          var submission = "";

          for (var key in ratingLocation){
              if (ratingLocation[key]){
                submission += ratingLocation[key] + " ";
              }
            }

          //use the google maps geocoder to get a latitude and longitude corresponding
          //to this address
          var geocoder = new google.maps.Geocoder();
          geocoder.geocode({"address": submission}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK){

              ratingLocation["lat"] = results[0].geometry.location.jb;
              ratingLocation["lng"] = results[0].geometry.location.kb;

              //it would be good if the geocoder could fill in any blanks in the user submission

              //store the data and continue
              localStorage.setItem("ratingLocation", JSON.stringify(ratingLocation));
              window.location.href = 'ratingformfromtemplate.html';
            }
            else {
              // this could be frustrating for the user if the location is not listed
              // perhaps program in another routine that removes the name before attempting to geolocate
              alert("Location not found. Please ensure you have entered the address information correctly.")
            }
          });

        });
        </script> 
    </body>
</html>
